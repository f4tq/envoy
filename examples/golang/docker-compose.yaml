version: "3.8"
services:

  proxy:
    build:
      context: .
      dockerfile: Dockerfile-proxy
    depends_on:
    - web_service
    ports:
    - "8080:8080"
    command: |
      /usr/local/bin/envoy -c /etc/envoy.yaml --log-level debug --service-cluster front-proxy
    volumes:
    - ./envoy-yaml_skip_config_test:/etc/envoy.yaml
    - ./lib/filter.so:/usr/local/go-plugins/filter.so

  web_service:
    environment:
      - PORT=9000
    build:
      context: ../shared/echo
